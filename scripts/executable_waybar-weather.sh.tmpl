#!/usr/bin/env bash

LOCATION={{ (env "LOCATION") | default "Oslo" }}

# Fetch weather data from wttr.in
# Format: %c = weather icon, %t = temperature, %w = wind, %p = precipitation
weather_data=$(curl -s "https://wttr.in/${LOCATION}?format=%c+%t+%w+%p&m" 2>/dev/null)

if [ -z "$weather_data" ]; then
    echo "  N/A"
    exit 0
fi

Convert km/h to m/s (divide by 3.6)
# Extract wind value with direction
wind=$(echo "$weather_data" | grep -oP '[↑↓←→↖↗↘↙]\K\d+(?=km/h)')
wind_dir=$(echo "$weather_data" | grep -oP '[↑↓←→↖↗↘↙](?=\d+km/h)')

if [ -n "$wind" ]; then
    wind_ms=$(awk "BEGIN {printf \"%.0f\", $wind/3.6}")
    weather_data=$(echo "$weather_data" | sed "s/${wind_dir}${wind}km\/h/${wind_dir}${wind_ms}m\/s/")
fi

# Remove % sign from precipitation if present
weather_data=$(echo "$weather_data" | sed 's/mm%/mm/')

echo "$weather_data"
