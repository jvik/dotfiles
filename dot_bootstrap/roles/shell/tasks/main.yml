---
- name: Set user shell to zsh
  ansible.builtin.user:
    name: '{{ user }}'
    shell: /bin/zsh
  become: true

- name: Check if oh my zsh is already installed
  ansible.builtin.stat:
    path: '/home/{{ user }}/.oh-my-zsh'
  register: shell_oh_my_zsh_stat

- name: Install Oh-My-Zsh
  ansible.builtin.git:
    repo: https://github.com/ohmyzsh/ohmyzsh.git
    dest: /home/{{ user }}/.oh-my-zsh
    version: 'master'
    clone: true
    update: true
  when: not shell_oh_my_zsh_stat.stat.exists

- name: Check if tpm plugin manager exists
  ansible.builtin.stat:
    path: '/home/{{ user }}/.config/tmux/plugins/tpm'
  register: shell_tpm_stat

- name: Install tpm plugin manager
  ansible.builtin.git:
    repo: https://github.com/tmux-plugins/tpm
    dest: '/home/{{ user }}/.config/tmux/plugins/tpm'
    version: 'master'
    clone: true
    update: true
  become: false
  when: not shell_tpm_stat.stat.exists
