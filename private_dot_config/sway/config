### Core Variables
set $mod Mod4
set $left h
set $down j
set $up k
set $right l

set $browser librewolf

### Theme
include ~/.config/sway/colors/gruvbox

### Startup Commands
exec --no-startup-id dbus-update-activation-environment --all
exec --no-startup-id lxpolkit
exec flatpak run com.bitwarden.desktop
# start copyq
exec /usr/bin/copyq --start-server

exec_always {
    rm /run/user/1000/pipectl.1000.wl-present.pipe 
}

exec_always {
    pkill kanshi
    kanshi &
}

exec_always "killall swaync; swaync"
exec_always "killall autotiling; $HOME/.local/bin/autotiling"

### Output Configuration
output * bg ~/.wallpaper fill

### Idle Configuration
set $locker swaylock -f
set $lockman exec bash ~/.config/sway/lockman.sh
set $monitorDisableTimeout 300
set $lockerTimeout 360
set $suspendTimeout $(if [ -f /sys/class/power_supply/AC/online ]; then echo 600; else echo 0; fi)

exec_always killall swayidle; swayidle -w \
    timeout $monitorDisableTimeout 'swaymsg "output * dpms off"' resume 'swaymsg "output * dpms on"' \
    timeout $lockerTimeout '$locker' \
    timeout $suspendTimeout 'systemctl suspend' \
    before-sleep '$locker' \
    lock '$locker'

### Input Configuration
input * {
    xkb_layout "no"
    xkb_options "caps:swapescape,altwin:swap_lalt_lwin"
}

input "1739:52839:SYNA8018:00_06CB:CE67_Touchpad" {
    tap enabled
    pointer_accel 0.2
    middle_emulation enabled
}


### Key Bindings
set $term wezterm
set $menu wofi --show drun

## Basics
bindsym $mod+Return exec $term
bindsym $mod+Shift+q kill
bindsym $mod+d exec $menu
bindsym $mod+Shift+f exec $browser
bindsym $mod+Shift+i exec ~/scripts/toggle-dark-mode.sh
bindsym $mod+x [urgent=latest] focus
bindsym $mod+Control+l exec $lockman
bindsym $mod+Shift+c reload
bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -B 'Yes, exit sway' 'swaymsg exit'

floating_modifier $mod normal
## Focus Movement
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

## Window Movement
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right
bindsym $mod+Shift+m sticky toggle

## Utility Bindings
bindsym $mod+Shift+a exec ~/scripts/a2dp-toggle.sh
bindsym $mod+Shift+d exec wdisplays
bindsym $mod+period exec ~/.local/bin/rofimoji --selector wofi --action copy

## Workspaces
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10
bindsym $mod+tab workspace back_and_forth

bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10

bindsym $mod+Control+Shift+Right move workspace to output right
bindsym $mod+Control+Shift+Left move workspace to output left
bindsym $mod+Control+Shift+Down move workspace to output down
bindsym $mod+Control+Shift+Up move workspace to output up

## Layout
bindsym $mod+b splith
bindsym $mod+v splitv
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split
bindsym $mod+f fullscreen
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle
bindsym $mod+a focus parent
bindsym $mod+z focus child

## Scratchpad
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show, floating disable

## Resize Mode
mode "resize" {
    bindsym $left resize shrink width 10px
    bindsym $down resize grow height 10px
    bindsym $up resize shrink height 10px
    bindsym $right resize grow width 10px
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

## Present Mode
mode "present" {
    bindsym m mode "default"; exec wl-present mirror
    bindsym o mode "default"; exec wl-present set-output
    bindsym r mode "default"; exec wl-present set-region
    bindsym Shift+r mode "default"; exec wl-present unset-region
    bindsym s mode "default"; exec wl-present set-scaling
    bindsym f mode "default"; exec wl-present toggle-freeze
    bindsym c mode "default"; exec wl-present custom
    bindsym k mode "default"; exec killall wl-mirror
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+shift+p mode "present"
bindsym XF86Display mode "present"

## Media and System Keys
bindsym --locked XF86AudioMute exec wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindsym --locked XF86AudioLowerVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindsym --locked XF86AudioRaiseVolume exec wpctl set-volume --limit 1.0 @DEFAULT_AUDIO_SINK@ 5%+
bindsym --locked XF86AudioMicMute exec wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindsym --locked XF86MonBrightnessDown exec brightnessctl set 5%-
bindsym --locked XF86MonBrightnessUp exec brightnessctl set 5%+
bindsym --locked XF86AudioPrev exec playerctl previous
bindsym --locked XF86AudioPlay exec playerctl play-pause
bindsym --locked XF86AudioNext exec playerctl next

## Screenshots
bindsym Print exec grim -o $(swaymsg -t get_outputs | jq -r '.[] | select(.focused) | .name') - | wl-copy --type image/png
bindsym $mod+p exec grim -g "$(slurp)" - | wl-copy --type image/png

## Clipboard Manager
bindsym $mod+Shift+v exec copyq toggle

## Notification Center
bindsym $mod+Shift+n exec swaync-client -t -sw

### Status Bar
bar {
    swaybar_command waybar
}

### Appearance
default_border normal 2
default_floating_border normal 2

### Window Rules

## Floating Windows
for_window [window_type="dialog"] floating enable
for_window [app_id="wdisplays"] floating enable
for_window [app_id="blueman-manager"] floating enable, border pixel 1, sticky enable
for_window [app_id="copyq"] floating enable, sticky enable, resize set height 600px width 550px, move position cursor, move down 330
for_window [class="Bitwarden"] floating enable
for_window [app_id="nmwui"] floating enable, move position center
for_window [app_id="Calculator|snap-store"] floating enable
for_window [app_id="org.pulseaudio.pavucontrol"] floating enable, border pixel 1, sticky enable, resize set width 40 ppt height 60 ppt
for_window [app_id="com.saivert.pwvucontrol"] floating enable
for_window [app_id="snx-rs-gui"] floating enable
for_window [title="^(?=.*Extension:)(?=.*Mozilla Firefox).*"] floating enable
for_window [title="^(Picture-in-Picture)$"] floating enable, sticky enable
for_window [title="Copying *"] floating enable
for_window [title="Moving *"] floating enable
for_window [title="Rename *"] floating enable
for_window [title="Firefox — Sharing Indicator"] floating enable
for_window [title="LibreWolf — Sharing Indicator"] floating enable
for_window [title="Remmina Remote Desktop Client"] floating enable, resize set width 800px height 600px, move position center
for_window [title="\ -\ Sharing\ Indicator$"] floating enable, sticky enable

## Workspace Assignments
assign [app_id="com.github.IsmaelMartinez.teams_for_linux"] 4
assign [class="Slack"] 5
assign [title="Plexamp"] 8
assign [app_id="spotify"] 8
assign [app_id="signal"] 9
assign [app_id="discord|vesktop"] 9

## Bring app to current workspace or launch it if not running
bindsym $mod+Shift+o exec "swaymsg '[class=\"obsidian\"] move container to workspace current, focus' || exec flatpak run md.obsidian.Obsidian"

workspace_auto_back_and_forth no
focus_on_window_activation focus

### System Includes
include /etc/sway/config.d/*
include ~/.config/sway/config.local
